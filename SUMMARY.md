<!-- SPDX-FileCopyrightText: 2025 Contributors to the Media eXchange Layer project. -->
<!-- SPDX-License-Identifier: CC-BY-4.0 -->

# MXL Project Summary

This is the top-level map of the MXL (Media eXchange Layer) codebase. Each section links to a deeper SUMMARY.md that tells the story of the files in that part of the project. Start here, follow the links, and you will understand the entire SDK.

---

## The Big Picture

MXL is a zero-copy shared-memory SDK for exchanging professional media (video, audio, ancillary data) between software functions on the same host or across hosts connected by high-speed fabrics (RDMA, EFA). It implements the exchange layer defined by the [EBU Dynamic Media Facility Reference Architecture](https://tech.ebu.ch/dmf/ra).

The project is organized into four layers:

1. **Core C/C++ Library** (`lib/`) - The engine: shared memory ring buffers, flow lifecycle, timing, synchronization.
2. **Fabrics Networking** (`lib/fabrics/`) - Extends flows across hosts using RDMA and libfabric.
3. **Rust Bindings** (`rust/`) - Safe Rust API, raw FFI bindings, and a GStreamer plugin.
4. **Tools** (`tools/`) - Command-line utilities for inspecting, demonstrating, and pipelining flows.

---

## Layer 1: Core C/C++ Library

### Public C API (`lib/include/mxl/`)

**[SUMMARY.md](lib/include/mxl/SUMMARY.md)**

This is the front door to MXL. Seven header files define the entire public contract:

- **platform.h** - Compiler portability macros (export, nodiscard, constexpr)
- **rational.h** - Exact fractional arithmetic for frame rates and sample rates
- **dataformat.h** - Media format classification (discrete vs continuous, video/audio/data)
- **mxl.h** - Instance lifecycle, error codes, version info, garbage collection
- **flowinfo.h** - Flow metadata structures (2048-byte header layout, config unions)
- **flow.h** - The core API: create/read/write flows, grains, samples, sync groups
- **time.h** - TAI timestamp utilities, index/time conversion, sleep helpers

### Internal C++ Implementation

**Headers: [SUMMARY.md](lib/internal/include/mxl-internal/SUMMARY.md)**

Thirty-three private headers implement the machinery behind the C API: shared memory mapping, futex-based synchronization, flow parsing, ring buffer geometry, grain I/O state machines, and continuous sample management.

**Sources: [SUMMARY.md](lib/internal/src/SUMMARY.md)**

The corresponding .cpp files bring those headers to life. Key files include the flow reader/writer engines, the grain commit pipeline, the continuous samples ring buffer, the shared memory mapper, and the garbage collector.

### Tests

**[SUMMARY.md](lib/tests/SUMMARY.md)**

Comprehensive Catch2 test suites covering flow creation, discrete grain I/O, continuous sample I/O, timing conversions, ring buffer wrap-around, multi-reader scenarios, and the fabrics networking path.

---

## Layer 2: Fabrics Networking

### Fabrics API (`lib/fabrics/`)

**[SUMMARY.md](lib/fabrics/SUMMARY.md)**

The fabrics layer replicates flows between hosts. It defines a provider-agnostic C API for remote flow readers and writers, connection management, and transport configuration.

### OFI/libfabric Backend (`lib/fabrics/ofi/src/`)

**[SUMMARY.md](lib/fabrics/ofi/src/SUMMARY.md)**

The concrete implementation using OpenFabrics Interfaces (OFI) / libfabric. Handles RDMA memory registration, completion queues, endpoint management, and the wire protocol for replicating grains and samples across nodes.

**Internal helpers: [SUMMARY.md](lib/fabrics/ofi/src/internal/SUMMARY.md)**

Low-level OFI abstractions: address vector management, completion queue polling, domain/fabric setup, memory region lifecycle, and reliable messaging patterns.

---

## Layer 3: Rust Bindings

### Safe Rust Wrapper (`rust/mxl/src/`)

**[SUMMARY.md](rust/mxl/src/SUMMARY.md)**

Idiomatic Rust API with ownership semantics, lifetime-tracked borrows, and RAII resource management. Wraps every C API function in a safe interface that prevents use-after-free, double-close, and dangling pointer bugs at compile time.

### FFI Bindings (`rust/mxl-sys/src/`)

**[SUMMARY.md](rust/mxl-sys/src/SUMMARY.md)**

Raw `unsafe` FFI bindings generated by bindgen. One-to-one mapping to the C API. Used by `mxl` crate internally; most users should prefer the safe wrapper.

### GStreamer Plugin (`rust/gst-mxl-rs/src/`)

**[SUMMARY.md](rust/gst-mxl-rs/src/SUMMARY.md)**

A GStreamer plugin providing `mxlsrc` (flow reader as GStreamer source) and `mxlsink` (GStreamer buffers written to MXL flows) elements. Enables integration with any GStreamer pipeline.

### Rust Examples (`rust/mxl/examples/`)

**[SUMMARY.md](rust/mxl/examples/SUMMARY.md)**

Working example programs demonstrating common patterns: writing video flows, reading audio samples, using sync groups, and inspecting flow metadata.

---

## Layer 4: Tools

### Tools Overview (`tools/`)

**[SUMMARY.md](tools/SUMMARY.md)**

Three command-line tools built on the MXL SDK:

- **mxl-info** ([SUMMARY.md](tools/mxl-info/SUMMARY.md)) - Flow inspector: lists flows in a domain, dumps metadata, monitors write activity.
- **mxl-gst** ([SUMMARY.md](tools/mxl-gst/SUMMARY.md)) - GStreamer pipeline launcher: pre-built pipelines for video playback, streaming, and recording.
- **mxl-fabrics-demo** ([SUMMARY.md](tools/mxl-fabrics-demo/SUMMARY.md)) - Networking demo: replicates flows between hosts using the Fabrics API.

---

## Documentation (`docs/`)

Detailed documentation covering every aspect of the SDK:

- [Architecture.md](docs/Architecture.md) - Shared memory model, security model, discrete vs continuous flows, grain format specifications, practical deployment examples
- [Usage.md](docs/Usage.md) - API usage patterns, flow lifecycle, reader/writer best practices
- [Timing.md](docs/Timing.md) - TAI timestamps, SMPTE ST 2059, index/time math, clock sources
- [Configuration.md](docs/Configuration.md) - SDK configuration options, flow parameters, tuning
- [Building.md](docs/Building.md) - Build instructions (CMake, devcontainer, vcpkg, cross-compilation)
- [Addressability.md](docs/Addressability.md) - Flow discovery, UUID mapping, NMOS integration
- [Tools.md](docs/Tools.md) - Tool usage, GStreamer pipeline recipes

---

## Build System and Configuration

- **CMakeLists.txt** - Top-level CMake configuration
- **CMakePresets.json** - Build presets (Debug, Release, CI)
- **vcpkg.json** - C/C++ dependency manifest
- **Doxyfile.in** - Doxygen API documentation generation template

## Governance and Community

- [GOVERNANCE.md](GOVERNANCE/GOVERNANCE.md) - Project governance model
- [CONTRIBUTING.md](CONTRIBUTING.md) - How to contribute code, docs, and tests
- [SECURITY.md](SECURITY.md) - Vulnerability reporting policy
- [CODE_OF_CONDUCT.md](CODE_OF_CONDUCT.md) - Community standards
- [LICENSE.txt](LICENSE.txt) - Apache 2.0 license
